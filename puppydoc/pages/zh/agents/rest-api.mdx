# REST API

通过 HTTP API 直接访问 PuppyOne 数据，适合自研 Agent 和自动化场景。

---

## 适用场景

- Python / Node.js 自研 Agent
- 自动化脚本
- 后端服务集成
- 不支持 MCP 的客户端

---

## 基础信息

### Base URL

```
https://api.puppyone.ai/api/v1
```

自托管环境：
```
http://localhost:9090/api/v1
```

### 认证方式

所有请求需要在 Header 中携带 API Key：

```
Authorization: Bearer sk_live_xxx
```

---

## 核心 API

### 查询数据

```bash
POST /tables/{table_id}/query
```

**请求体**:
```json
{
  "path": "/products",
  "filter": {
    "price": { "$lt": 100 }
  }
}
```

**响应**:
```json
{
  "data": [
    { "id": "SKU-001", "name": "Widget Mini", "price": 59.99 },
    { "id": "SKU-002", "name": "Gadget Lite", "price": 79.99 }
  ],
  "error": null
}
```

**示例 (Python)**:
```python
import requests

response = requests.post(
    "https://api.puppyone.ai/api/v1/tables/tbl_xxx/query",
    headers={"Authorization": "Bearer sk_live_xxx"},
    json={
        "path": "/products",
        "filter": {"price": {"$lt": 100}}
    }
)
data = response.json()["data"]
```

---

### 获取全部数据

```bash
GET /tables/{table_id}/data?path=/products
```

**响应**:
```json
{
  "data": {
    "products": [...]
  },
  "error": null
}
```

**示例 (curl)**:
```bash
curl -X GET "https://api.puppyone.ai/api/v1/tables/tbl_xxx/data?path=/products" \
  -H "Authorization: Bearer sk_live_xxx"
```

---

### 创建数据

```bash
POST /tables/{table_id}/data
```

**请求体**:
```json
{
  "path": "/products",
  "data": {
    "id": "SKU-003",
    "name": "New Widget",
    "price": 129.99
  }
}
```

**示例 (Node.js)**:
```javascript
const response = await fetch(
  "https://api.puppyone.ai/api/v1/tables/tbl_xxx/data",
  {
    method: "POST",
    headers: {
      "Authorization": "Bearer sk_live_xxx",
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      path: "/products",
      data: { id: "SKU-003", name: "New Widget", price: 129.99 }
    })
  }
);
```

---

### 更新数据

```bash
PUT /tables/{table_id}/data
```

**请求体**:
```json
{
  "path": "/products/0/price",
  "value": 89.99
}
```

---

### 删除数据

```bash
DELETE /tables/{table_id}/data?path=/products/0
```

---

## 过滤器语法

查询时可以使用丰富的过滤条件：

### 比较操作符

| 操作符 | 含义 | 示例 |
|--------|------|------|
| `$eq` | 等于 | `{"status": {"$eq": "active"}}` |
| `$ne` | 不等于 | `{"status": {"$ne": "deleted"}}` |
| `$gt` | 大于 | `{"price": {"$gt": 100}}` |
| `$gte` | 大于等于 | `{"price": {"$gte": 100}}` |
| `$lt` | 小于 | `{"price": {"$lt": 100}}` |
| `$lte` | 小于等于 | `{"price": {"$lte": 100}}` |

### 逻辑操作符

```json
{
  "$and": [
    {"price": {"$gte": 50}},
    {"price": {"$lte": 100}}
  ]
}
```

```json
{
  "$or": [
    {"category": "电子"},
    {"category": "配件"}
  ]
}
```

### 数组操作符

```json
{
  "tags": {"$in": ["热销", "新品"]}
}
```

---

## 错误处理

### 响应格式

所有响应都遵循统一格式：

```json
{
  "data": ...,
  "error": null
}
```

错误时：

```json
{
  "data": null,
  "error": {
    "code": "NOT_FOUND",
    "message": "Table not found"
  }
}
```

### 常见错误码

| 错误码 | HTTP 状态 | 说明 |
|--------|----------|------|
| `UNAUTHORIZED` | 401 | API Key 无效 |
| `FORBIDDEN` | 403 | 权限不足 |
| `NOT_FOUND` | 404 | 资源不存在 |
| `VALIDATION_ERROR` | 422 | 请求参数错误 |
| `RATE_LIMITED` | 429 | 请求过于频繁 |

---

## 速率限制

| 计划 | 限制 |
|------|------|
| Free | 100 请求/分钟 |
| Pro | 1000 请求/分钟 |
| Team | 无限制 |

超过限制时返回 429 状态码，Header 中包含：
- `X-RateLimit-Limit`: 总配额
- `X-RateLimit-Remaining`: 剩余配额
- `X-RateLimit-Reset`: 重置时间

---

## SDK

### Python SDK（即将推出）

```python
from puppyone import PuppyOne

client = PuppyOne(api_key="sk_live_xxx")
products = client.tables.get("tbl_xxx").query(
    path="/products",
    filter={"price": {"$lt": 100}}
)
```

### TypeScript SDK（即将推出）

```typescript
import { PuppyOne } from '@puppyone/sdk';

const client = new PuppyOne({ apiKey: 'sk_live_xxx' });
const products = await client.tables.get('tbl_xxx').query({
  path: '/products',
  filter: { price: { $lt: 100 } }
});
```

---

## 完整示例：Python Agent

```python
import os
import requests

class PuppyOneClient:
    def __init__(self, api_key: str, table_id: str):
        self.api_key = api_key
        self.table_id = table_id
        self.base_url = "https://api.puppyone.ai/api/v1"
    
    def query(self, path: str, filter: dict = None):
        response = requests.post(
            f"{self.base_url}/tables/{self.table_id}/query",
            headers={"Authorization": f"Bearer {self.api_key}"},
            json={"path": path, "filter": filter or {}}
        )
        return response.json()["data"]
    
    def get_all(self, path: str = "/"):
        response = requests.get(
            f"{self.base_url}/tables/{self.table_id}/data",
            headers={"Authorization": f"Bearer {self.api_key}"},
            params={"path": path}
        )
        return response.json()["data"]

# 使用示例
client = PuppyOneClient(
    api_key=os.environ["PUPPYONE_API_KEY"],
    table_id="tbl_xxx"
)

# 查询产品
cheap_products = client.query("/products", {"price": {"$lt": 100}})
print(f"找到 {len(cheap_products)} 个便宜产品")

# 获取所有分类
categories = client.get_all("/categories")
print(f"分类列表: {categories}")
```

---

## 下一步

- [访问控制](/zh/access) - 管理 API 权限
- [API 参考](/zh/reference/api) - 完整 API 文档



