<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qllama API 示例</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 10px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input, textarea, button {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .error {
            color: #d32f2f;
        }
    </style>
</head>
<body>
    <h1>Qllama API 示例</h1>
    
    <div class="container">
        <div class="card">
            <h2>提供商列表</h2>
            <button id="load-providers">加载提供商</button>
            <div id="providers-result" class="result">点击按钮加载提供商列表...</div>
        </div>
        
        <div class="card">
            <h2>模型列表</h2>
            <div class="form-group">
                <label for="model-type">模型类型</label>
                <select id="model-type">
                    <option value="all">所有模型</option>
                    <option value="llm">LLM模型</option>
                    <option value="embedding">嵌入模型</option>
                </select>
            </div>
            <button id="load-models">加载模型</button>
            <div id="models-result" class="result">选择模型类型并点击按钮加载模型列表...</div>
        </div>
        
        <div class="card">
            <h2>文本生成</h2>
            <div class="form-group">
                <label for="llm-provider">提供商</label>
                <select id="llm-provider"></select>
            </div>
            <div class="form-group">
                <label for="llm-model">模型</label>
                <select id="llm-model"></select>
            </div>
            <div class="form-group">
                <label for="llm-prompt">提示文本</label>
                <textarea id="llm-prompt" rows="4" placeholder="输入提示文本...">告诉我法国的首都是什么？</textarea>
            </div>
            <div class="form-group">
                <label for="llm-system">系统提示（可选）</label>
                <textarea id="llm-system" rows="2" placeholder="输入系统提示...">你是一个有用的AI助手，提供简短准确的回答。</textarea>
            </div>
            <div class="form-group">
                <label for="llm-max-tokens">最大生成长度</label>
                <input type="number" id="llm-max-tokens" value="500" min="1" max="4096">
            </div>
            <div class="form-group">
                <label for="llm-temperature">温度 (0-1)</label>
                <input type="number" id="llm-temperature" value="0.7" min="0" max="1" step="0.1">
            </div>
            <button id="generate-text">生成文本</button>
            <div id="generate-result" class="result">点击按钮生成文本...</div>
        </div>
        
        <div class="card">
            <h2>文本嵌入</h2>
            <div class="form-group">
                <label for="embed-provider">提供商</label>
                <select id="embed-provider"></select>
            </div>
            <div class="form-group">
                <label for="embed-model">模型</label>
                <select id="embed-model"></select>
            </div>
            <div class="form-group">
                <label for="embed-texts">文本（每行一个）</label>
                <textarea id="embed-texts" rows="4" placeholder="输入文本...">Hello, world!
测试嵌入功能</textarea>
            </div>
            <button id="generate-embeddings">生成嵌入</button>
            <div id="embed-result" class="result">点击按钮生成嵌入...</div>
        </div>
    </div>

    <script>
        // API基础URL，根据实际部署情况修改
        const API_BASE_URL = 'http://localhost:5000/api';
        
        // 工具函数：显示加载中状态
        function showLoading(elementId) {
            document.getElementById(elementId).classList.add('loading');
            document.getElementById(elementId).textContent = '加载中...';
        }
        
        // 工具函数：显示错误
        function showError(elementId, error) {
            document.getElementById(elementId).classList.remove('loading');
            document.getElementById(elementId).classList.add('error');
            document.getElementById(elementId).textContent = `错误: ${error}`;
        }
        
        // 工具函数：显示结果
        function showResult(elementId, result) {
            document.getElementById(elementId).classList.remove('loading', 'error');
            document.getElementById(elementId).textContent = typeof result === 'string' 
                ? result
                : JSON.stringify(result, null, 2);
        }
        
        // 获取提供商列表
        document.getElementById('load-providers').addEventListener('click', async () => {
            try {
                showLoading('providers-result');
                const response = await fetch(`${API_BASE_URL}/providers`);
                const data = await response.json();
                
                if (data.success) {
                    showResult('providers-result', data.providers);
                    
                    // 更新提供商下拉列表
                    const llmProviderSelect = document.getElementById('llm-provider');
                    const embedProviderSelect = document.getElementById('embed-provider');
                    
                    llmProviderSelect.innerHTML = '';
                    embedProviderSelect.innerHTML = '';
                    
                    data.providers.forEach(provider => {
                        llmProviderSelect.innerHTML += `<option value="${provider}">${provider}</option>`;
                        embedProviderSelect.innerHTML += `<option value="${provider}">${provider}</option>`;
                    });
                    
                    // 触发模型加载
                    llmProviderSelect.dispatchEvent(new Event('change'));
                    embedProviderSelect.dispatchEvent(new Event('change'));
                } else {
                    showError('providers-result', data.error || '加载提供商失败');
                }
            } catch (error) {
                showError('providers-result', error.message);
            }
        });
        
        // 获取模型列表
        document.getElementById('load-models').addEventListener('click', async () => {
            try {
                const modelType = document.getElementById('model-type').value;
                
                showLoading('models-result');
                
                let url = `${API_BASE_URL}/models`;
                if (modelType === 'llm') {
                    url = `${API_BASE_URL}/models/llm`;
                } else if (modelType === 'embedding') {
                    url = `${API_BASE_URL}/models/embedding`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    if (modelType === 'llm') {
                        showResult('models-result', data.llm_models);
                    } else if (modelType === 'embedding') {
                        showResult('models-result', data.embedding_models);
                    } else {
                        showResult('models-result', data.models);
                    }
                } else {
                    showError('models-result', data.error || '加载模型失败');
                }
            } catch (error) {
                showError('models-result', error.message);
            }
        });
        
        // 生成文本
        document.getElementById('generate-text').addEventListener('click', async () => {
            try {
                const provider = document.getElementById('llm-provider').value;
                const model = document.getElementById('llm-model').value;
                const prompt = document.getElementById('llm-prompt').value;
                const systemMessage = document.getElementById('llm-system').value;
                const maxTokens = parseInt(document.getElementById('llm-max-tokens').value);
                const temperature = parseFloat(document.getElementById('llm-temperature').value);
                
                if (!model || !prompt) {
                    showError('generate-result', '请选择模型并输入提示文本');
                    return;
                }
                
                showLoading('generate-result');
                
                const response = await fetch(`${API_BASE_URL}/llm/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        provider,
                        model,
                        prompt,
                        system_message: systemMessage,
                        max_tokens: maxTokens,
                        temperature
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('generate-result', data.text);
                } else {
                    showError('generate-result', data.error || '生成文本失败');
                }
            } catch (error) {
                showError('generate-result', error.message);
            }
        });
        
        // 生成嵌入
        document.getElementById('generate-embeddings').addEventListener('click', async () => {
            try {
                const provider = document.getElementById('embed-provider').value;
                const model = document.getElementById('embed-model').value;
                const textsRaw = document.getElementById('embed-texts').value;
                const texts = textsRaw.split('\n').filter(t => t.trim());
                
                if (!model || texts.length === 0) {
                    showError('embed-result', '请选择模型并输入至少一行文本');
                    return;
                }
                
                showLoading('embed-result');
                
                const response = await fetch(`${API_BASE_URL}/embedding/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        provider,
                        model,
                        texts
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // 简化显示，只显示维度和前5个数值
                    const result = {
                        count: data.embeddings.length,
                        dimensions: data.embeddings[0].length,
                        sample: data.embeddings[0].slice(0, 5) + '...'
                    };
                    showResult('embed-result', result);
                } else {
                    showError('embed-result', data.error || '生成嵌入失败');
                }
            } catch (error) {
                showError('embed-result', error.message);
            }
        });
        
        // 提供商变化时加载对应的模型
        document.getElementById('llm-provider').addEventListener('change', async () => {
            try {
                const provider = document.getElementById('llm-provider').value;
                if (!provider) return;
                
                const response = await fetch(`${API_BASE_URL}/models/llm`);
                const data = await response.json();
                
                if (data.success) {
                    const llmModelSelect = document.getElementById('llm-model');
                    llmModelSelect.innerHTML = '';
                    
                    if (data.llm_models[provider] && data.llm_models[provider].length > 0) {
                        data.llm_models[provider].forEach(model => {
                            llmModelSelect.innerHTML += `<option value="${model}">${model}</option>`;
                        });
                    } else {
                        llmModelSelect.innerHTML = '<option value="">该提供商没有LLM模型</option>';
                    }
                }
            } catch (error) {
                console.error('加载LLM模型失败:', error);
            }
        });
        
        document.getElementById('embed-provider').addEventListener('change', async () => {
            try {
                const provider = document.getElementById('embed-provider').value;
                if (!provider) return;
                
                const response = await fetch(`${API_BASE_URL}/models/embedding`);
                const data = await response.json();
                
                if (data.success) {
                    const embedModelSelect = document.getElementById('embed-model');
                    embedModelSelect.innerHTML = '';
                    
                    if (data.embedding_models[provider] && data.embedding_models[provider].length > 0) {
                        data.embedding_models[provider].forEach(model => {
                            embedModelSelect.innerHTML += `<option value="${model}">${model}</option>`;
                        });
                    } else {
                        embedModelSelect.innerHTML = '<option value="">该提供商没有嵌入模型</option>';
                    }
                }
            } catch (error) {
                console.error('加载嵌入模型失败:', error);
            }
        });
        
        // 页面加载时尝试获取提供商列表
        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('load-providers').click();
        });
    </script>
</body>
</html> 