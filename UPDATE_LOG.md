
# 更新日志

## 核心修改

1. **移除原先的User模块，User模块请直接对接Supabase。**
2. **所有接口需要在Header传入`Authorization: Bear <token>`**
3. **数据库表修改**：
   1. **DELETE**: 移除`user_temp`表。
   2. **MODIFY**: 数据库表所有`user_id`都从`int`改成`str`，适配Auth表。
   3. **MODIFY**: 
4. **MCP统一路由地址**: 添加mcp统一路由地址，不需要访问到各个mcp服务本身。TODO: 后续MCP服务本身不需要鉴权，不对外暴露。

## 接口修改

1. **DELETE** 移除原先的User模块。User模块和登陆相关的信息请前端直接对接Supabase。
2. **MODIFY** Table模块修改
   1. **接口修改**：List接口从`GET /api/v1/tables/user/{user_id}`修改成`GET /api/v1/tables/`, 通过Token获取用户ID信息，并返回所有项目和对应的Table。
   2. **安全性**：通过依赖注入实现所有接口的Token鉴权和数据权限校验。
3. **MODIFY** MCP模块
   1. **安全性**：通过依赖注入实现所有接口的Token鉴权和数据权限校验。

## MCP服务重构

**现有方案的问题**:
1. 资源消耗高: 当MCP Instance数量上升后，系统端口资源、进程资源、内存资源将快速耗尽。
2. 端口管理复杂: 端口管理复杂，容易冲突。
3. 服务监控复杂: 需要监控子进程的状态, 服务升级会牵扯到这些MCP服务, 需要逐个重启。
4. 可观测性差: 每个子进程的日志分散，难以集中监控
5. 状态一致性: 数据库中的状态和进程的状态可能不一致。

**方案设计**:
1. 单实例MCP服务，不同租户隔离数据 + 工具 + 状态。问题：FastMCP框架无法实现这种工具隔离，需要自己实现一个动态工具工厂模式。