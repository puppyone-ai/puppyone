# Rich Structured Editor - 详细功能规格文档

## 核心元素类型及视觉设计

### 1. Text 元素（文本类型）

#### 视觉外观
```
┌─────────────────────────────────────┐
│ [••] "Hello World"                  │  ← 左侧灰色边框(#CDCDCD)，拖拽手柄
│                                     │    内容区域显示文本内容
└─────────────────────────────────────┘
```

**详细样式规格**：
- **边框颜色**: `#CDCDCD/40` (40% 透明度)
- **边框宽度**: 2px，圆角
- **悬停效果**: 边框变为 4px，颜色加深到 `#CDCDCD`
- **拖拽手柄**: 6个灰色圆点组成的网格图标
- **背景**: 透明，悬停时 `#CDCDCD/10`
- **内边距**: 16px (左右) × 8px (上下)

#### 交互逻辑
1. **点击编辑**: 点击文本区域直接进入Monaco Editor编辑模式
2. **自动调整高度**: 根据文本行数自动调整容器高度
3. **拖拽移动**: 点击拖拽手柄可将整个文本元素移动到其他位置

### 2. Dict 元素（字典/对象类型）

#### 视觉外观
```
    ┌─ ═════════════════════════════ ┐                          
    │ "name"   | [••]"John Doe"      │  ← 键值对，键为紫色斜体
    │────────────────────────────────│  ← 分隔线
    │ "age"    | [••] 25             │
[••]│────────────────────────────────│  ← 对整个dict元素的拖拽手柄
    │ "skills" | [••] []             │
    │   [+]                          │  ← 添加新键按钮
    │                                │
    └────────────────────────────────┘
```

**详细样式规格**：
- **边框颜色**: `#9b7edb` (紫色)
- **键名样式**: 紫色(`#9b7edb`)、斜体、10px字体
- **键宽度**: 固定64px，超出省略
- **分隔线**: `#6D7177/70` 1px实线
- **空对象显示**: "empty object, click [+] to add" 提示文字

#### 键值对操作逻辑
1. **键名生成**: 新键名格式 `key_[6位随机字符]`，确保不重复
2. **键名冲突处理**: 如存在同名键，自动生成新的随机键名
3. **键值拖拽**: 每个值前有单独的拖拽手柄，可移动到其他位置
4. **添加新键**: 点击 `[+]` 按钮在对象末尾添加空元素

### 3. List 元素（数组类型）

#### 视觉外观
```
    ┌─ ═════════════════════════════ ┐                          
    │ [0]      | [••]"First item"    │  ← 索引显示，橙色斜体
    │────────────────────────────────│  ← 分隔线
    │ [1]      | [••]"Second item"   │
[••]│────────────────────────────────│  ← 对整个list元素的拖拽手柄
    │ [2]      | [••]{ name: "..." } │
    │   [+]                          │  ← 添加新项按钮
    │                                │
    └────────────────────────────────┘
```

**详细样式规格**：
- **边框颜色**: `#ff9b4d` (橙色)
- **索引样式**: 橙色(`#ff9b4d`)、斜体、10px字体
- **索引宽度**: 固定64px，居中显示
- **空数组显示**: "empty list, click [+] to add" 提示文字

#### 索引管理逻辑
1. **索引自动分配**: 从0开始递增，插入时自动重新编号
2. **拖拽重排**: 拖拽元素到新位置时，所有索引自动重新计算
3. **删除处理**: 删除元素后，后续元素索引自动前移

### 4. Empty 元素（空值/类型选择）

#### 视觉外观
```
┌─────────────────────────────────────┐
│ create a type [📝] [📋] [📃]       │  ← 类型选择按钮
│                                     │
└─────────────────────────────────────┘
```

**类型选择按钮**：
- **Text**: 📝 图标 + "text" 标签
- **Dict**: 📋 图标 + "dict" 标签  
- **List**: 📃 图标 + "list" 标签

## 拖拽移动系统

### 拖拽手柄设计

#### 1. 统一的拖拽交互
- **Dict元素**: 拖拽键名区域（紫色斜体文本）来移动整个键值对
- **List元素**: 拖拽索引区域（橙色斜体数字）来移动单个列表项
- **Text元素**: 拖拽左侧的`[•••]`按钮来移动文本元素（仅在容器内显示）
- **整个容器**: 拖拽左侧的`[•••]`按钮来移动整个Dict/List容器

#### 2. 拖拽手柄特点
- **无额外UI元素**: 使用现有的界面元素作为拖拽手柄
- **语义化设计**: 拖拽的区域与要移动的内容逻辑对应
- **视觉反馈**: hover时显示`cursor-move`，明确表示可拖拽
- **条件显示**: Text元素的拖拽功能只在嵌套环境中启用

### 拖拽状态视觉反馈

#### 1. 拖拽开始状态
```
原位置: [透明度50%] "被拖拽元素"  ← 半透明显示
鼠标: [拖拽预览框] "Hello World"   ← 跟随鼠标的预览框
```

#### 2. 有效放置区域
```
┌─────────────────────────────────────┐
│ existing item                       │
│ ███████████████████████████████████ │  ← 蓝色插入线(#3b82f6)
│ ● ← 蓝色圆点指示器                   │
└─────────────────────────────────────┘
```

#### 3. 无效放置区域
```
┌─────────────────────────────────────┐
│ 🚫 不允许放置的区域                  │  ← 禁止图标 + 红色边框
└─────────────────────────────────────┘
```

### 移动逻辑处理

#### Dict中的移动
1. **内部重排**: 在同一对象内移动时，保持键名不变，仅调整顺序
2. **跨对象移动**: 移动到其他对象时：
   - 保持原键名（如不冲突）
   - 键名冲突时生成新的随机键名
   - 自动删除原位置的键值对

#### List中的移动
1. **内部重排**: 删除原索引，在目标位置插入，重新编号所有索引
2. **跨列表移动**: 从源列表删除，向目标列表添加，两边都重新编号

#### 跨类型移动
- **Dict→List**: 只移动值，丢弃键名，获得新的数组索引
- **List→Dict**: 生成新的随机键名，值保持不变
- **任何类型→Text**: 如果目标是文本容器，会被拒绝（显示禁止图标）

## 上下文菜单系统

### 菜单触发
每个元素左边框上的 `[•••]` 按钮，悬停时出现：

```
┌─ [•••] ┐  ← 点击触发菜单
│  ┌─────────────┐
│  │ 📋 Copy     │
│  │ 🗑️ Clear    │
│  │ ❌ Delete   │  ← 只在嵌套元素中显示
│  └─────────────┘
```

### 操作逻辑

#### Copy（复制）
- 将当前元素的JSON字符串复制到剪贴板
- 格式化输出，保持2空格缩进

#### Clear（清空）
- **Text**: 设置为空字符串 `""`
- **Dict**: 设置为 `null`，显示类型选择器
- **List**: 设置为 `null`，显示类型选择器

#### Delete（删除）
- 仅在嵌套元素中显示
- **Dict中的键**: 完全删除该键值对
- **List中的项**: 删除该项，后续索引前移
- **根级元素**: 不显示删除选项

## 空值处理和元素创建

### Null值处理
当任何元素被设置为 `null` 时：
1. 显示类型选择界面
2. 用户可选择创建 Text、Dict 或 List
3. 创建后替换null值

### 新元素创建流程

#### 在Dict中创建
1. 点击 `[+]` 按钮
2. 生成新的随机键名
3. 创建空元素（显示类型选择器）
4. 用户选择类型后初始化对应数据结构

#### 在List中创建
1. 点击 `[+]` 按钮
2. 在数组末尾添加空元素
3. 分配新的索引号
4. 用户选择类型后初始化对应数据结构

#### 初始创建（空画布）
1. 显示 "Create New Component" 大按钮
2. 点击后显示类型选择器
3. 选择类型后创建根级数据结构

### 数据结构初始化值
- **Text**: `""`（空字符串）
- **Dict**: `{}`（空对象）
- **List**: `[]`（空数组）

## 错误状态处理

### JSON解析错误
```
┌─────────────────────────────────────┐
│ ⚠️ Invalid JSON                     │  ← 红色边框
│                                     │
│ { "name": "John                     │  ← 显示错误的JSON
│   ^-- 缺少引号                       │  ← 错误提示
└─────────────────────────────────────┘
```

### 空状态提示
```
┌─────────────────────────────────────┐
│          Enter JSON data...         │  ← 居中显示占位文字
│                                     │
│     [Create New Component]          │  ← 创建按钮
└─────────────────────────────────────┘
```

## 响应式行为

### 高度自适应
- **Text**: 根据内容行数动态调整，最小40px，最大300px
- **Dict/List**: 根据子元素数量自动扩展，无最大高度限制
- **Monaco Editor**: 集成代码编辑器，支持语法高亮和自动完成

### 宽度处理  
- 所有元素占满容器宽度
- 键名区域固定64px
- 内容区域自适应剩余宽度

## 复杂嵌套结构示例

### 核心示例: 多层嵌套数据结构
```json
{
  "api_response": {
    "users": [
      {
        "id": 1001,
        "profile": {
          "name": "Alice",
          "contacts": ["email@example.com", "+1234567890"],
          "settings": {
            "theme": "dark",
            "notifications": {
              "email": true,
              "push": false
            }
          }
        }
      }
    ],
    "meta": {
      "total": 1,
      "version": "2.0"
    }
  }
}
```

#### 完整嵌套结构可视化（所有层级一体展示）
```
┌─ ═══════════════════════════════════════════════════════════════════════════════════════ ┐ (根Dict-紫色)
│ "api_response" | [••] ┌─ ══════════════════════════════════════════════════════════════ ┐│
│                       │ "users" | [••] ┌─ ════════════════════════════════════════════ ┐││
│                       │                │ [0] | [••] ┌─ ═══════════════════════════════ ┐│││
│                       │                │            │ "id" | [••] 1001                 ││││
│                       │                │            │─────────────────────────────────││││
│                       │                │            │ "profile" | [••] ┌─ ═══════════ ┐││││
│                       │                │            │                  │ "name":"Alice"│││││
│                       │                │            │                  │──────────────│││││
│                       │                │            │                  │ "contacts":  │││││
│                       │                │            │                  │ ┌─ ═══════ ┐│││││
│                       │                │            │                  │ │[0] email ││││││
│                       │                │            │                  │ │─────────││││││
[••]│                       │                │            │                  │ │[1] phone ││││││
│                       │                │            │                  │ └─────────┘│││││
│                       │                │            │                  │──────────────│││││
│                       │                │            │                  │ "settings":  │││││
│                       │                │            │                  │ ┌─ ═══════ ┐│││││
│                       │                │            │                  │ │"theme":   ││││││
│                       │                │            │                  │ │ "dark"    ││││││
│                       │                │            │                  │ │──────────││││││
│                       │                │            │                  │ │"notif":   ││││││
│                       │                │            │                  │ │┌─ ═════ ┐││││││
│                       │                │            │                  │ ││"email":T│││││││
│                       │                │            │                  │ ││────────│││││││
│                       │                │            │                  │ ││"push":F │││││││
│                       │                │            │                  │ │└────────┘││││││
│                       │                │            │                  │ └──────────┘│││││
│                       │                │            │                  └──────────────┘││││
│                       │                │            └──────────────────────────────────┘│││
│                       │                │   [+]                                        │││
│                       │                └──────────────────────────────────────────────┘││
│                       │────────────────────────────────────────────────────────────────││
│                       │ "meta" | [••] ┌─ ══════════════════════════════════════════════ ┐││
│                       │               │ "total"   | [••] 1                            │││
│                       │               │────────────────────────────────────────────────│││
│                       │               │ "version" | [••] "2.0"                        │││
│                       │               │   [+]                                          │││
│                       │               └────────────────────────────────────────────────┘││
│                       │   [+]                                                          ││
│                       └────────────────────────────────────────────────────────────────┘│
│   [+]                                                                                    │
└──────────────────────────────────────────────────────────────────────────────────────────┘
```

## 复杂操作场景

### 场景1: 跨层级拖拽移动

**操作**: 将 `users[0].name` 拖拽到 `pagination` 对象中

**过程可视化**:
```
拖拽开始:
    users[0] → "name" | [••]"Alice"  (50% 透明度)
    
拖拽预览: 
    鼠标跟随 → [拖拽框] "Alice"
    
目标区域:
    ┌─ pagination ════════════════ ┐                        
    │ "total"    | [••] 2          │ 
    │ ███████████████████████████ │ ← 蓝色插入线
    │ "page"     | [••] 1          │
    │────────────────────────────│ 
    │ "pageSize" | [••] 10         │
    └────────────────────────────┘

完成后:
    pagination对象新增键 "name": "Alice"
    原位置 users[0].name 被删除
```

### 场景2: 数组元素重排

**操作**: 将 `interests[3]` ("阅读") 移动到索引1的位置

**过程**:
```
原始状态:
    ┌─ interests ═════════════════ ┐                        
    │ [0] | [••]"技术"             │ 
    │────────────────────────────│ 
    │ [1] | [••]"音乐"             │
    │────────────────────────────│ 
    │ [2] | [••]"运动"             │
    │────────────────────────────│ 
    │ [3] | [••]"阅读"             │ ← 拖拽这个
    └────────────────────────────┘

拖拽到位置1:
    ┌─ interests ═════════════════ ┐                        
    │ [0] | [••]"技术"             │ 
    │ ███████████████████████████ │ ← 蓝色插入线
    │ [1] | [••]"音乐"             │
    │────────────────────────────│ 
    │ [2] | [••]"运动"             │
    └────────────────────────────┘

最终结果 (索引重新分配):
    ┌─ interests ═════════════════ ┐                        
    │ [0] | [••]"技术"             │ 
    │────────────────────────────│ 
    │ [1] | [••]"阅读"             │ ← 新位置
    │────────────────────────────│ 
    │ [2] | [••]"音乐"             │ ← 索引自动调整
    │────────────────────────────│ 
    │ [3] | [••]"运动"             │ ← 索引自动调整
    └────────────────────────────┘
```

### 场景3: 类型转换操作

**操作**: 将简单数组 `["admin", "editor"]` 转换为对象数组

**转换过程**:
```
原始 roles 数组:
    ┌─ roles ════════════════════ ┐                        
    │ [0] | [••]"admin"            │ 
[••]│────────────────────────────│ 
    │ [1] | [••]"editor"           │
    │   [+]                       │ 
    └────────────────────────────┘

用户操作: 
1. 右键点击 roles[0] → Clear
2. 选择类型 → Dict
3. 添加键值对

转换后:
    ┌─ roles ════════════════════ ┐                        
    │ [0] | [••] {Dict}            │ 
[••]│────────────────────────────│ 
    │ [1] | [••]"editor"           │
    │   [+]                       │ 
    └────────────────────────────┘
        ↓ 展开 roles[0]
    ┌─ ═══════════════════════════ ┐                        
    │ "name"        | [••]"admin"  │ 
    │──────────────────────────────│ 
    │ "permissions" | [••] [List]  │
[••]│──────────────────────────────│ 
    │ "level"       | [••] 5       │
    │   [+]                        │ 
    └──────────────────────────────┘
```

### 场景4: 批量元素创建

**操作**: 在空对象中快速创建多个预设字段

**流程**:
```
空对象状态:
    ┌─ ═══════════════════════════ ┐                        
[••]│ empty object, click [+] to add │
    │           [+]                │ 
    └──────────────────────────────┘

连续点击 [+] 创建字段:
    ┌─ ═══════════════════════════ ┐                        
    │ "key_abc123" | [Type Selector] │ ← 第1个空字段
    │──────────────────────────────│ 
    │ "key_def456" | [Type Selector] │ ← 第2个空字段
[••]│──────────────────────────────│ 
    │ "key_ghi789" | [Type Selector] │ ← 第3个空字段
    │   [+]                        │ 
    └──────────────────────────────┘

用户选择类型后:
    ┌─ ═══════════════════════════ ┐                        
    │ "key_abc123" | [••]"text"     │ 
    │──────────────────────────────│ 
    │ "key_def456" | [••] 42        │
[••]│──────────────────────────────│ 
    │ "key_ghi789" | [••] [List]    │
    │   [+]                        │ 
    └──────────────────────────────┘
```

## 高级特性和边界情况处理

### 深度嵌套限制
- 最大嵌套深度: 10层 (防止性能问题)
- 超出限制时显示警告: "⚠️ 嵌套过深，建议简化结构"

### 大数据处理
- 数组长度 > 100 时启用虚拟滚动
- 对象键数量 > 50 时提供搜索过滤功能
- 单个文本字段 > 1000 字符时折叠显示

### 键名冲突智能处理
```
场景: 拖拽时目标对象已存在同名键

原对象: {"name": "Alice", "age": 25}
拖入: "name": "Bob"

自动处理:
1. 检测冲突 → "name" 已存在
2. 生成新键名 → "name_xyz789"  
3. 插入: {"name": "Alice", "age": 25, "name_xyz789": "Bob"}
4. 显示提示: "⚠️ 键名冲突，已重命名为 name_xyz789"
```

### 撤销/重做功能
- 支持最近20步操作的撤销
- 操作类型: 移动、删除、类型转换、值编辑
- 键盘快捷键: Ctrl+Z / Ctrl+Y

## 深度嵌套能力展示

系统支持任意深度的嵌套结构，能够处理以下复杂模式：
- **Dict→List→Dict→List** 循环嵌套（如数据库schema定义）
- **递归树形结构**（如文件系统、组织架构）
- **混合类型嵌套**（List包含Dict，Dict包含List，无限循环）

```
Level 0: ┌─ Dict ─┐
Level 1: │ └─ List ─┐
Level 2: │   └─ Dict ─┐
Level 3: │     └─ List ─┐
Level 4: │       └─ Dict ─┐
Level 5: │         └─ Dict ─┐
Level 6: │           └─ Dict ─┐
Level 7: │             └─ Dict ─┐
Level 8: │               └─ Dict ─┐
Level 9: │                 └─ List ─┐
Level 10:│                   └─ Dict ─┐
Level 11:│                     └─ Text
         └ 系统可支持更深层级...
```

#### 深层元素跨级拖拽
```
从深层Text拖拽到顶层List:
源路径: Level 11 → root.children[0].children[0].children[0].metadata.tags.related_files[0].name  
目标路径: Level 2 → root.children[]

拖拽预览: [拖拽框] "backup.txt" 跟随鼠标
放置提示: ███████ 蓝色插入线显示在目标位置

结果: 
- 源位置的related_files[0]被删除，数组重新编号  
- 目标位置新增元素，自动分配新索引
```

### 示例6: 循环嵌套的树形结构 (Dict包含自引用)
```json
{
  "file_system": {
    "root": {
      "type": "directory",
      "name": "/",
      "children": [
        {
          "type": "directory", 
          "name": "home",
          "children": [
            {
              "type": "directory",
              "name": "user",
              "children": [
                {
                  "type": "file",
                  "name": "document.txt",
                  "metadata": {
                    "size": 1024,
                    "permissions": ["read", "write"],
                    "tags": {
                      "category": "document",
                      "importance": "high",
                      "related_files": [
                        {"name": "backup.txt", "path": "/home/user/backups/"},
                        {"name": "draft.txt", "path": "/home/user/drafts/"}
                      ]
                    }
                  }
                }
              ]
            }
          ]
        },
        {
          "type": "directory",
          "name": "etc",
          "children": [
            {
              "type": "file",
              "name": "config.json", 
              "metadata": {
                "size": 2048,
                "config_sections": {
                  "database": {
                    "connections": [
                      {"name": "primary", "host": "localhost"},
                      {"name": "backup", "host": "backup.server.com"}
                    ]
                  }
                }
              }
            }
          ]
        }
      ]
    }
  }
}
```

#### 可视化渲染效果 (完整树形结构一体化展示)
```
┌─ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════ ┐
│ "file_system" | [••] ┌─ ═══════════════════════════════════════════════════════════════════════════════════ ┐│
│                      │ "root" | [••] ┌─ ═══════════════════════════════════════════════════════════════════ ┐││
│                      │               │ "type" | [••]"directory"                                            │││
│                      │               │──────────────────────────────────────────────────────────────────────│││
│                      │               │ "name" | [••]"/"                                                    │││
│                      │               │──────────────────────────────────────────────────────────────────────│││
│                      │               │ "children" | [••] ┌─ ═══════════════════════════════════════════════ ┐│││
│                      │               │                   │ [0] | [••] ┌─ ═════════════════════════════════ ┐││││
│                      │               │                   │            │ "type" | [••]"directory"          │││││
│                      │               │                   │            │─────────────────────────────────│││││
│                      │               │                   │            │ "name" | [••]"home"              │││││
│                      │               │                   │            │─────────────────────────────────│││││
│                      │               │                   │            │ "children" | [••] ┌─ ═══════════ ┐│││││
│                      │               │                   │            │                   │ [0] | {Dict} ││││││
[••]│                      │               │                   │            │                   │ ┌─ ═══════ ┐││││││
│                      │               │                   │            │                   │ │"type":"dir"│││││││
│                      │               │                   │            │                   │ │──────────│││││││
│                      │               │                   │            │                   │ │"name":"usr"│││││││
│                      │               │                   │            │                   │ │──────────│││││││
│                      │               │                   │            │                   │ │"children":│││││││
│                      │               │                   │            │                   │ │┌─ ═════ ┐│││││││
│                      │               │                   │            │                   │ ││[0]     ││││││││
│                      │               │                   │            │                   │ ││┌─ ═══ ┐││││││││
│                      │               │                   │            │                   │ │││"type":│││││││││
│                      │               │                   │            │                   │ │││"file" │││││││││
│                      │               │                   │            │                   │ │││──────│││││││││
│                      │               │                   │            │                   │ │││"name":│││││││││
│                      │               │                   │            │                   │ │││"doc.t"│││││││││
│                      │               │                   │            │                   │ │││──────│││││││││
│                      │               │                   │            │                   │ │││"meta":│││││││││
│                      │               │                   │            │                   │ │││┌─ ═ ┐│││││││││
│                      │               │                   │            │                   │ ││││size││││││││││
│                      │               │                   │            │                   │ ││││1024││││││││││
│                      │               │                   │            │                   │ ││││────││││││││││
│                      │               │                   │            │                   │ ││││perm││││││││││
│                      │               │                   │            │                   │ ││││[r,w]│││││││││
│                      │               │                   │            │                   │ ││││────││││││││││
│                      │               │                   │            │                   │ ││││tags││││││││││
│                      │               │                   │            │                   │ ││││{...}│││││││││
│                      │               │                   │            │                   │ │││└────┘│││││││││
│                      │               │                   │            │                   │ ││└──────┘││││││││
│                      │               │                   │            │                   │ │└────────┘│││││││
│                      │               │                   │            │                   │ └──────────┘││││││
│                      │               │                   │            │                   └──────────────┘│││││
│                      │               │                   │            └──────────────────────────────────┘││││
│                      │               │                   │────────────────────────────────────────────────││││
│                      │               │                   │ [1] | [••] ┌─ ═════════════════════════════════ ┐││││
│                      │               │                   │            │ "type" | [••]"directory"          │││││
│                      │               │                   │            │─────────────────────────────────│││││
│                      │               │                   │            │ "name" | [••]"etc"               │││││
│                      │               │                   │            │─────────────────────────────────│││││
│                      │               │                   │            │ "children" | [••] ┌─ ═══════════ ┐│││││
│                      │               │                   │            │                   │ [0] | {Dict} ││││││
│                      │               │                   │            │                   │ "type":"file"││││││
│                      │               │                   │            │                   │ "name":"cfg" ││││││
│                      │               │                   │            │                   │ "metadata":{} ││││││
│                      │               │                   │            │                   └──────────────┘│││││
│                      │               │                   │            └──────────────────────────────────┘││││
│                      │               │                   │   [+]                                          ││││
│                      │               │                   └────────────────────────────────────────────────┘│││
│                      │               │   [+]                                                              │││
│                      │               └────────────────────────────────────────────────────────────────────┘││
│                      │   [+]                                                                              ││
│                      └────────────────────────────────────────────────────────────────────────────────────┘│
│   [+]                                                                                                      │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 复杂嵌套的拖拽场景

#### 场景: 深层Text元素跨多层移动
**操作**: 将第11层的 `related_files[0].name` ("backup.txt") 拖拽到第2层的 `/etc` 目录的 `children` 数组中

**拖拽路径可视化**:
```
拖拽源 (Level 11):
  file_system.root.children[0].children[0].children[0].metadata.tags.related_files[0].name

拖拽目标 (Level 3): 
  file_system.root.children[1].children[]

拖拽过程:
┌─ 源位置 ═══════════════════════════ ┐                        
│ "name" | [••]"backup.txt"  ← 50%透明度
└────────────────────────────────────┘
        ↓ 移动路径
┌─ 目标位置 ═════════════════════════ ┐                        
│ [0] | [••] {Dict}  ← config.json    │ 
│ ███████████████████████████████████ │ ← 蓝色插入线
│   [+]                              │ 
└─────────────────────────────────────┘

最终结果:
- 源位置的 related_files[0] 对象被删除
- related_files 数组重新编号: [1] → [0]
- 目标 /etc children 数组新增: [1] → "backup.txt" (Text)
```

#### 场景: 整个嵌套结构的移动
**操作**: 将整个 `metadata` 对象 (Level 8) 移动到另一个文件对象中

**结构移动效果**:
```
移动前 - document.txt 结构:
    └── metadata (Level 8)
        ├── size: 1024
        ├── permissions: [List]
        └── tags (Level 9)
            ├── category: "document"
            ├── importance: "high"  
            └── related_files (Level 10)
                ├── [0] {Dict}
                │   ├── name: "backup.txt"
                │   └── path: "/home/user/backups/"
                └── [1] {Dict}
                    ├── name: "draft.txt"
                    └── path: "/home/user/drafts/"

移动后 - config.json 获得完整的 metadata 结构:
    └── metadata (移动到此处，保持完整的嵌套关系)
        ├── size: 1024
        ├── permissions: [List]  
        └── tags
            ├── category: "document"
            ├── importance: "high"
            └── related_files
                ├── [0] {Dict}
                └── [1] {Dict}
```
- 提供灵活的数据结构调整能力

**成功指标**：
- 类型识别准确率 > 99%
- 类型转换操作完成率 > 95%
- 因类型错误导致的用户投诉 < 1%

### 2. 直观的可视化编辑

**功能描述**：
- 不同数据类型使用不同颜色和图标标识
- 层次结构通过视觉缩进清晰展示
- 支持折叠/展开复杂结构

**设计原则**：
- **颜色语义化**：文本(灰色)、对象(紫色)、数组(橙色)
- **层级可视化**：左侧边框和缩进展示数据深度
- **状态反馈**：悬停、选中、编辑状态即时反馈

**用户价值**：
- 一眼识别数据结构和类型
- 快速定位和导航到目标数据
- 减少认知负担，提高操作效率

### 3. 拖拽式数据重组

**功能描述**：
- 支持任意元素的拖拽移动
- 智能显示放置位置提示
- 跨层级、跨类型的数据迁移

**交互设计**：
- 拖拽开始时显示半透明预览
- 目标位置显示蓝色插入线
- 无效放置区域显示禁止图标

**用户价值**：
- 所见即所得的数据重组体验
- 大幅提升复杂结构调整效率
- 避免复制粘贴的繁琐操作

### 4. 智能内容辅助

**功能描述**：
- 空数据结构提供创建引导
- 智能建议常用数据模板
- 自动补全和格式修正

**辅助机制**：
- 悬停提示显示操作指南
- 右键菜单提供快捷操作
- 键盘快捷键支持高效操作

**用户价值**：
- 降低新手学习曲线
- 提升专家用户操作速度
- 减少操作错误和重复劳动

## 用户体验设计

### 设计哲学：渐进式复杂度

#### 1. 新手友好
- **零状态设计**：空白画布提供清晰的开始指引
- **引导式创建**：通过按钮和提示引导用户完成首次操作
- **错误预防**：界面设计阻止用户做出错误操作

#### 2. 专家高效
- **快捷操作**：为熟练用户提供键盘快捷键和批量操作
- **自定义选项**：支持界面布局和功能的个性化配置
- **高级功能**：复制、导入导出、批量编辑等专业功能

#### 3. 容错性设计
- **撤销重做**：支持多步操作的撤销和重做
- **自动保存**：防止意外丢失编辑内容
- **版本对比**：显示编辑前后的差异对比

### 信息架构

#### 视觉层次
1. **主要内容区**：数据编辑的核心工作区域
2. **辅助工具栏**：常用操作和功能按钮
3. **状态指示器**：显示当前编辑状态和系统反馈

#### 导航模式
- **面包屑导航**：显示当前数据位置的完整路径
- **结构大纲**：侧边栏显示整体数据结构概览
- **搜索定位**：支持按键名或值内容快速定位

## 业务价值与成功指标

### 关键成果指标 (KPIs)

#### 用户体验指标
- **学习时间**：新用户完成首次编辑 < 3 分钟
- **操作效率**：相比传统编辑器提升效率 > 300%
- **错误率**：数据格式错误发生率 < 0.1%
- **用户满意度**：NPS 评分 > 70

#### 业务价值指标
- **用户留存**：月活跃用户留存率 > 80%
- **功能采用**：核心功能使用率 > 90%
- **技术支持**：因使用问题的客服咨询减少 > 60%
- **团队协作**：跨团队数据配置协作效率提升 > 200%

### 投资回报分析

#### 开发成本节约
- 减少 60% 的数据配置相关 Bug
- 降低 40% 的技术支持工作量
- 提升 50% 的跨团队协作效率

#### 用户价值创造
- 非技术用户独立完成复杂配置
- 开发者专注核心业务逻辑开发
- 团队整体数据管理能力提升

## 竞品分析与差异化

### 竞品对比

| 产品特性 | 传统 JSON 编辑器 | 在线 JSON 工具 | **Rich Editor** |
|---------|------------------|----------------|-----------------|
| 学习成本 | 高 | 中 | **低** |
| 视觉化程度 | 低 | 中 | **高** |
| 交互体验 | 差 | 一般 | **优秀** |
| 错误处理 | 基础 | 中等 | **智能** |
| 协作支持 | 无 | 有限 | **强大** |

### 核心差异化优势

1. **视觉化优先**：完全摒弃传统代码编辑模式
2. **零技术门槛**：非技术用户也能轻松使用
3. **智能交互**：AI 驱动的操作建议和错误预防
4. **无缝集成**：与现有系统的完美融合

## 产品路线图

### 第一阶段：核心功能 (MVP)
- 基础的可视化编辑能力
- 三种数据类型支持（文本、对象、数组）
- 拖拽重排功能
- 基础的错误处理

### 第二阶段：体验优化
- 智能提示和自动补全
- 撤销重做功能
- 键盘快捷键支持
- 性能优化

### 第三阶段：高级功能
- 模板库和预设配置
- 协作编辑功能
- 版本控制和历史记录
- 批量操作工具

### 第四阶段：智能化
- AI 驱动的结构建议
- 智能数据类型推荐
- 自然语言数据生成
- 高级数据分析功能

## 风险与挑战

### 技术风险
- **性能挑战**：大规模数据结构的渲染性能
- **兼容性问题**：不同浏览器的行为差异
- **复杂度管理**：功能增加带来的系统复杂度

### 用户采用风险
- **习惯改变**：用户从传统工具迁移的阻力
- **学习投入**：初期投入时间成本的心理障碍
- **信任建立**：对新工具可靠性的担忧

### 缓解策略
- **渐进式推广**：从内部团队开始试用推广
- **用户教育**：提供完善的使用教程和最佳实践
- **反馈循环**：建立快速的用户反馈和产品迭代机制

## 结论

Rich Structured Editor 不仅是一个工具，更是数据民主化的践行者。通过消除技术壁垒、提升用户体验，我们让每个人都能成为数据的主人。这不只是产品功能的创新，更是对未来工作方式的重新定义。

我们相信，当数据编辑变得像使用 Word 一样简单时，整个团队的创造力将得到空前的释放。